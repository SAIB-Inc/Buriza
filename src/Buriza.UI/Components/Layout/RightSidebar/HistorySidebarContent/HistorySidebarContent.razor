@using Buriza.UI.Components.Common
@using Buriza.UI.Components.Controls
@using Buriza.UI.Resources
@using Buriza.UI.Data.Dummy
@using Buriza.Data.Models.Common
@using Buriza.Data.Models.Enums

@namespace Buriza.UI.Components.Layout

<div class="bg-[var(--mud-palette-drawer-background)] !rounded-[16px] !pt-4 !pb-0 h-full">
    <div class="w-full flex items-center justify-between !px-4">
        <div class="flex items-center !gap-3 h-[38px]">
            <div>
                <MudText Class="!font-medium !text-[22px]">
                    History
                </MudText>
            </div>
        </div>
        <div>
            <MudIconButton
                Icon="@BurizaIcons.FilterSymbolIcon"
                Class="[&_.mud-icon-root]:!text-[var(--mud-palette-text-primary)] !p-0"
            />
        </div>
    </div>
    <div class="w-full !space-y-6 !mt-4 !px-4 !pb-4 overflow-y-auto max-h-[calc(100vh-196px)]">
        @foreach (KeyValuePair<string, List<TransactionHistory>> dateGroup in TransactionsByDate)
        {
            <div>
                <div class="w-full !mb-3">
                    <MudText Class="!text-center !font-medium !text-sm">
                        @dateGroup.Key
                    </MudText>
                </div>
                <div class="!space-y-4">
                    @foreach (TransactionHistory transaction in dateGroup.Value)
                    {
                        <div>
                            <div class="w-full flex items-center justify-between !mb-2">
                                <div>
                                    <MudText Class="!text-xs !text-[var(--mud-palette-text-secondary)]">
                                        @Utils.GetRelativeTime(transaction.Timestamp)
                                    </MudText>
                                </div>
                                <div class="flex items-center justify-end !gap-2">
                                    <MudText Class="!text-sm !text-[var(--mud-palette-text-secondary)] !font-medium">
                                        @transaction.TransactionId
                                    </MudText>
                                    <MudIconButton
                                        Icon="@BurizaIcons.CopySymbolIcon"
                                        Class="!p-0 [&_.mud-icon-root]:!text-base [&_.mud-icon-root]:!text-[var(--mud-palette-text-secondary)]/60"
                                    />
                                </div>
                            </div>
                            <div class="rounded-r-[12px] overflow-hidden !shadow-sm">
                                @foreach (TransactionAsset asset in transaction.Assets)
                                {
                                    <BurizaButton
                                        Class="@($"py-2! px-4! h-max! bg-[var(--mud-palette-dark)]! even:bg-[var(--mud-palette-drawer-background)]! rounded-none! w-full !flex !items-center !justify-between border-l-2! {Utils.GetTransactionTypeColor(transaction.Type)} md:bg-[var(--mud-palette-info-lighten)]! md:even:bg-[var(--mud-palette-dark-text)]!")"
                                    >
                                        <div class="flex items-center gap-4!">
                                            <div class="aspect-square rounded-full overflow-hidden w-10 h-10 ">
                                                <MudImage
                                                    Alt="@asset.AssetName"
                                                    Src="@asset.AssetIcon"
                                                />
                                            </div>
                                            <div class="!mt-1">
                                                <MudText Class="!text-[var(--mud-palette-text-primary)] !font-semibold !text-sm !text-start">
                                                    @Utils.GetTransactionTypeText(transaction.Type)
                                                </MudText>
                                                <MudText Class="!text-[var(--mud-palette-text-secondary)] !text-sm !text-start">
                                                    @asset.AssetName
                                                </MudText>
                                            </div>
                                        </div>
                                        <div class="flex flex-col items-end justify-center w-full">
                                            <MudText Class="@($"!text-sm !font-semibold !text-end {(transaction.Type == TransactionType.Sent ? "!text-[var(--mud-palette-error)]" : "!text-[var(--mud-palette-success)]")}")">
                                                @(transaction.Type == TransactionType.Sent ? "-" : "+")@Math.Abs(asset.Amount).ToString("F2")
                                            </MudText>
                                            <MudText Class="!text-sm !text-[var(--mud-palette-text-secondary)] !w-max !text-end">
                                                â‰ˆ $@asset.UsdValue.ToString("F2")
                                            </MudText>
                                        </div>
                                    </BurizaButton>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>
